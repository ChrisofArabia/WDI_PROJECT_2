"use strict";var photoWalk=photoWalk||{},google=google;photoWalk.home=function(e){e&&e.preventDefault(),this.$main.html('\n    <div class="imagebackdrop">\n      <h1>Welcome to our Humble Home Page</h1>\n      <p>We hope you\'ll enjoy your stay here and choose to hang out a while</p>\n    </div\n    ')},photoWalk.adminTemplate=function(){var e='\n    <div class="admin-content">\n      <nav class="pure-menu admin-menu">\n        <h3 class="menu-heading">Admin Menu</h3>\n        <ul class="pure-menu-list">\n          <li class="pure-menu-item"><a href="#" class="pure-menu-link landmark-admin">Edit Landmarks</a></li>\n          <li class="pure-menu-item"><a href="#" class="pure-menu-link walk">Edit Walks</a></li>\n          <li class="pure-menu-item"><a href="#" class="pure-menu-link user">Edit Users</a></li>\n        </ul>\n      </nav>\n      <section class="admin-body">\n        <h1>Welcome to the admin section</h1>\n      </section>\n    </div>\n    ';this.$main.html(e)},photoWalk.register=function(e){e&&e.preventDefault;var t="\n    <h2>Register</h2>\n    ",o='\n    <form class="pure-form" method="post" action="/register">\n      <div class="form-group">\n        <label for="username">Enter your username: </label>\n        <input id="username" class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <label for="email">Enter an email address: </label>\n        <input id="email" class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <label for="email">Enter a password: </label>\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <label for="password_conf">Enter the password again: </label>\n        <input id="password_conf" class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="pure-button pure-button-primary" type="submit" value="Register">\n    </form>\n    ',a='\n    <p>Made with <span class="redheart">&hearts;</span> at <a href="https://generalassemb.ly/locations/london">GA</a> in London</p>\n    ';photoWalk.modalTemplate(t,o,a)},photoWalk.login=function(e){e&&e.preventDefault();var t="\n    <h2>Login</h2>\n    ",o='\n    <form class="pure-form" method="post" action="/login">\n      <div class="form-group">\n        <label for="email">Enter your registered email address: </label>\n        <input id="email" class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <label for="password">Enter your password: </label>\n        <input id="password" class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="pure-button pure-button-primary" type="submit" value="Login">\n    </form>\n    ',a='\n    <p>Made with <span class="redheart">&hearts;</span> at <a href="https://generalassemb.ly/locations/london">GA</a> in London</p>\n    ';photoWalk.modalTemplate(t,o,a)},photoWalk.landmarkIndex=function(e){var t=this;e&&e.preventDefault(),$.ajax({method:"GET",url:"http://localhost:3000/api/landmarks",beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(function(e){var o="";$.each(e.landmarks,function(e,a){o+='\n        <tr id="'+a._id+'">\n          <td>'+(e+1)+'</td>\n          <td><a href="'+t.apiUrl+"/landmarks/"+a._id+'">'+a.name+"</a></td>\n          <td>"+a.address+". "+a.postcode+'.</td>\n          <td><a href="'+a.website+'">'+a.website+'</a></td>\n          <td><button class="button-warning pure-button"><i class="fa fa-pencil fa-fw"></button></i></td>\n          <td><button class="button-error pure-button"><i class="fa fa-trash-o fa-fw"></button></td>\n        </tr>\n      '});var a='\n      <h2 class="admin-header">Landmark Administration</h2>\n      <table class="pure-table pure-table-bordered">\n        <thead>\n          <tr>\n            <th>#</th>\n            <th>Name</th>\n            <th>Address & Postcode</th>\n            <th>Website</th>\n            <th>Edit</th>\n            <th>Delete</th>\n          </tr>\n        </thead>\n        <tbody>'+o+"</tbody>\n      </table>\n      ";$(".admin-body").html(a)})},photoWalk.AutocompleteDirectionsHandler=function(){this.originPlaceId=null,this.destinationPlaceId=null,this.originInput=document.getElementById("origin-input"),this.destinationInput=document.getElementById("destination-input"),this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer,this.directionsDisplay.setMap(this.map),this.originAutocomplete=new google.maps.places.Autocomplete(this.originInput,{placeIdOnly:!0}),this.destinationAutocomplete=new google.maps.places.Autocomplete(this.destinationInput,{placeIdOnly:!0}),this.setupAutocompletePlaceChangedListener(this.originAutocomplete,"ORIG"),this.setupAutocompletePlaceChangedListener(this.destinationAutocomplete,"DEST")},photoWalk.setupAutocompletePlaceChangedListener=function(e,t){var o=this;e.bindTo("bounds",o.map),e.addListener("place_changed",function(){var a=e.getPlace();return a.place_id?void("ORIG"===t?o.originPlaceId=a.place_id:o.destinationPlaceId=a.place_id):void window.alert("Please select an option from the dropdown list.")})},photoWalk.route=function(waypoints,name){var self=this;if(!self.originPlaceId||!self.destinationPlaceId)return void console.log("No originPlaceId, destinationPlaceId");for(var waypts=[],i=0;i<waypoints.length;i++){var tmp=eval(waypoints[i]);waypts.push({location:{lng:tmp[0],lat:tmp[1]},stopover:!0})}self.directionsService.route({origin:{placeId:self.originPlaceId},destination:{placeId:self.destinationPlaceId},travelMode:"WALKING",waypoints:waypts,optimizeWaypoints:!0},function(e,t){"OK"===t?self.directionsDisplay.setDirections(e):window.alert("Directions request failed due to "+t)});var walk={walkName:name,origin:self.originPlaceId,destination:self.destinationPlaceId,wayPoints:waypoints};return photoWalk.ajaxRequest("/api/walks","post",{walk:walk},function(e){console.log(e)})},photoWalk.makeRoute=function(e){e&&e.preventDefault(),photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html("");var t=$(e.target).find("#name").val(),o=$(e.target).find('input[name="waypoints"]:checked').map(function(){return $(this).val()}).toArray();photoWalk.route(o,t)},photoWalk.createRoute=function(e){e&&e.preventDefault(),$.ajax({method:"GET",url:"http://localhost:3000/api/landmarks",beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(function(e){var t="";$.each(e.landmarks,function(e,o){t+='<label class="check-waypoint"><input name="waypoints" type="checkbox" value="['+o.lng+", "+o.lat+']"> - '+o.name+"<br>"});var o="<h2>Create a Route</h2>",a='\n      <form id="makeRoute" class="pure-form pure-form-stacked">\n        <fieldset class="form-fields">\n          <div class="form-group">\n            <label for="name">Add a name for your new route: </label>\n            <input id="name" class="form-control" type="text" name="name" placeholder="Add route name">\n          </div>\n          <div class="form-group">\n            <input id="origin-input" class="controls" type="text" placeholder="Enter an origin location">\n          </div>\n          <div class="form-group">\n            <input id="destination-input" class="controls" type="text" placeholder="Enter a destination location">\n          </div>\n          <div class="form-group">\n            <label for="waypoints">Enter your chosen waypoints: </label>\n            '+t+'\n          </div>\n          <input class="pure-button pure-button-primary" type="submit" value="Create Route">\n        </fieldset>\n      </form>\n      ',n='\n      <p>Made with <span class="redheart">&hearts;</span> at <a href="https://generalassemb.ly/locations/london">GA</a> in London</p>';photoWalk.modalTemplate(o,a,n),photoWalk.AutocompleteDirectionsHandler()})},photoWalk.plotRoute=function(e){var _this2=this;e.preventDefault(),$.ajax({method:"GET",url:$(e.target).attr("href"),beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(function(data){for(var walk=data.walk,waypts=[],i=0;i<walk.wayPoints.length;i++){var tmp=eval(walk.wayPoints[i]);waypts.push({location:{lng:tmp[0],lat:tmp[1]},stopover:!0})}_this2.directionsService=new google.maps.DirectionsService,_this2.directionsDisplay=new google.maps.DirectionsRenderer,_this2.directionsDisplay.setMap(_this2.map),photoWalk.directionsService.route({origin:{placeId:walk.origin},destination:{placeId:walk.destination},travelMode:"WALKING",waypoints:waypts,optimizeWaypoints:!0},function(e,t){"OK"===t?(console.log("Response is: ",e),photoWalk.directionsDisplay.setDirections(e)):window.alert("Directions request failed due to "+t)})})},photoWalk.availableRouteMenu=function(e){e&&e.preventDefault();var t="http://localhost:3000/api/walks",o="GET";$.ajax({method:o,url:t,beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(function(e){var o="";$.each(e.walks,function(e,a){o+='<li class="pure-menu-item"><a href="'+t+"/"+a._id+'" class="pure-menu-link plotRoute">'+a.walkName+"</a></li>"}),$("#walk-menu").html(o)})},photoWalk.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},photoWalk.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.$main.html('<div id="map-canvas"></div>'),this.setupMap(),photoWalk.availableRouteMenu()},photoWalk.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.$main.html('<div id="map-canvas"></div>'),this.setupMap()},photoWalk.removeToken=function(){return window.localStorage.clear()},photoWalk.handleForm=function(e){if(e.preventDefault(),"makeRoute"!==$(this).attr("id")){var t=""+photoWalk.apiUrl+$(this).attr("action"),o=$(this).attr("method"),a=$(this).serialize();return photoWalk.ajaxRequest(t,o,a,function(e){e.token&&(photoWalk.setToken(e.token),photoWalk.loggedInState(),photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html(""))})}},photoWalk.ajaxRequest=function(e,t,o,a){return $.ajax({url:e,method:t,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(a).fail(function(e){console.log(e)})},photoWalk.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this.getToken())},photoWalk.setToken=function(e){return window.localStorage.setItem("token",e)},photoWalk.getToken=function(){return window.localStorage.getItem("token")},photoWalk.addInfoWindowForLandmark=function(e,t){var o=this,a="";google.maps.event.addListener(t,"click",function(){"undefined"!=typeof o.infoWindow&&o.infoWindow.close(),a=e.website?"\n      <a href='"+e.website+"'>\n        <h3>"+e.name+"</h3>\n      </a>\n      ":"<h3>"+e.name+"</h3>",o.infoWindow=new google.maps.InfoWindow({content:"\n      <img src='../images/"+e.file+"' alt='"+e.name+"'>\n      "+a+"\n      <p>"+e.address+"</p>\n      <p>"+e.postcode+"</p>\n      "}),o.infoWindow.open(o.map,t)})},photoWalk.createMarkerForLandmark=function(e){var t=new google.maps.LatLng(e.lat,e.lng),o=new google.maps.Marker({position:t,map:this.map,animation:google.maps.Animation.DROP});this.addInfoWindowForLandmark(e,o)},photoWalk.loopThroughLandmarks=function(e){$.each(e.landmarks,function(e,t){setTimeout(function(){photoWalk.createMarkerForLandmark(t)},50*e)})},photoWalk.getLandmarks=function(){$.ajax({method:"GET",url:"http://localhost:3000/api/landmarks",beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(this.loopThroughLandmarks)},photoWalk.modalTemplate=function(e,t,o){var a='\n    <div class="modal-content">\n      <span class="close">&times;</span>\n      <div class="modal-header">'+e+'</div>\n      <div class="modal-body">'+t+'</div>\n      <div class="modal-footer">'+o+"</div>\n    </div>\n    ";this.$modalContainer.html(a),photoWalk.callModal()},photoWalk.callModal=function(){this.$modalContainer.css("display","block"),$(".close").on("click",function(){photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html("")}),$(window).on("click",function(e){e.target.className===photoWalk.$modalContainer[0].className&&(photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html(""))})},photoWalk.setupMap=function(){var e=document.getElementById("map-canvas"),t={zoom:15,center:new google.maps.LatLng(51.516026,(-.062226)),mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(e,t),this.getToken()&&this.getLandmarks()},photoWalk.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),this.$modalContainer=$("#modal"),this.setupMap(),$(".home").on("click",this.home.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".createRoute").on("click",this.createRoute.bind(this)),$(".admin").on("click",this.adminTemplate.bind(this)),$(".modal").on("submit","#makeRoute",this.makeRoute.bind(this)),$("body").on("click",".landmark-admin",this.landmarkIndex.bind(this)),$("body").on("click",".plotRoute",this.plotRoute.bind(this)),this.$main.on("submit","form",this.handleForm),this.$modalContainer.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},$(photoWalk.init.bind(photoWalk));