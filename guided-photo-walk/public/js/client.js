"use strict";var photoWalk=photoWalk||{},google=google;photoWalk.home=function(o){o&&o.preventDefault(),this.$main.html('\n    <div class="imagebackdrop">\n      <h1>Welcome to our Humble Home Page</h1>\n      <p>We hope you\'ll enjoy your stay here and choose to hang out a while</p>\n    </div\n    ')},photoWalk.register=function(o){o&&o.preventDefault,this.$main.html('\n    <h2>Register</h2>\n    <form class="pure-form" method="post" action="/register">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="pure-button pure-button-primary" type="submit" value="Register">\n    </form>\n    ')},photoWalk.login=function(o){o&&o.preventDefault(),this.$main.html('\n    <h2>Login</h2>\n    <form class="pure-form" method="post" action="/login">\n      <div class="form-group">\n        <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="pure-button pure-button-primary" type="submit" value="Login">\n    </form>\n    ')},photoWalk.userEdit=function(o){o&&o.preventDefault();var e="http://localhost:3000/api/users",t=e+"/"+$(this).attr("href"),n="PUT";photoWalk.ajaxRequest(t,n,null,function(o){console.log("ajaxRequest: "+t),photoWalk.$main.html('\n      <h2>Edit User Profile</h2>\n      <form class="pure-form" method="put" action="/users/'+o.user._id+'">\n        <div class="form-group">\n          <label for="username">User Name</label>\n          <input id="username" class="form-control" type="text" name="user[username]" placeholder="Username" value="'+o.user.username+'">\n        </div>\n        <div class="form-group">\n          <label for="bio">User Biography</label>\n          <input id="bio" class="form-control" type="text" name="user[bio]" placeholder="User bio" value="'+o.user.bio+'">\n        </div>\n        <div class="form-group">\n          <label for="img">Profile Image URL</label>\n          <input id="img" class="form-control" type="text" name="user[img]" value="'+o.user.profilePic+'">\n        </div>\n        <input class="pure-button pure-button-primary" type="submit" value="Update Profile">\n      </form>\n      ')})},photoWalk.logout=function(o){o.preventDefault(),this.removeToken(),this.loggedOutState()},photoWalk.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide()},photoWalk.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.home()},photoWalk.removeToken=function(){return window.localStorage.clear()},photoWalk.handleForm=function(o){o.preventDefault();var e=""+photoWalk.apiUrl+$(this).attr("action"),t=$(this).attr("method"),n=$(this).serialize();return photoWalk.ajaxRequest(e,t,n,function(o){o.token&&(photoWalk.setToken(o.token),photoWalk.loggedInState())})},photoWalk.ajaxRequest=function(o,e,t,n){return $.ajax({url:o,method:e,data:t,beforeSend:this.setRequestHeader.bind(this)}).done(n).fail(function(o){console.log(o)})},photoWalk.setRequestHeader=function(o){return o.setRequestHeader("Authorization","Bearer "+this.getToken())},photoWalk.setToken=function(o){return window.localStorage.setItem("token",o)},photoWalk.getToken=function(){return window.localStorage.getItem("token")},photoWalk.addInfoWindowForLandmark=function(o,e){var t=this;google.maps.event.addListener(e,"click",function(){"undefined"!=typeof t.infoWindow&&t.infoWindow.close(),t.infoWindow=new google.maps.InfoWindow({content:"\n      <img src='../images/"+o.file+"' alt='"+o.name+"'>\n      <a href='"+o.website+"'>\n        <h3>"+o.name+"</h3>\n      </a>\n      <p>"+o.address+"</p>\n      <p>"+o.postcode+"</p>\n      "}),t.infoWindow.open(t.map,e)})},photoWalk.createMarkerForLandmark=function(o){var e=new google.maps.LatLng(o.lat,o.lng),t=new google.maps.Marker({position:e,map:this.map,animation:google.maps.Animation.DROP});this.addInfoWindowForLandmark(o,t)},photoWalk.loopThroughLandmarks=function(o){$.each(o.landmarks,function(o,e){setTimeout(function(){photoWalk.createMarkerForLandmark(e)},50*o)})},photoWalk.getLandmarks=function(){$.get("http://localhost:3000/api/landmarks").done(this.loopThroughLandmarks)},photoWalk.callModal=function(){var o=document.getElementById("modal"),e=document.getElementsByClassName("close")[0];o.style.display="block",e.onclick=function(){o.style.display="none"},window.onclick=function(e){e.target===o&&(o.style.display="none")}},photoWalk.init=function(){var o=document.getElementById("map-canvas"),e={zoom:15,center:new google.maps.LatLng(51.516026,(-.062226)),mapTypeId:google.maps.MapTypeId.ROADMAP};this.apiUrl="http://localhost:3000/api",this.$main=$("main"),this.map=new google.maps.Map(o,e),this.getLandmarks(),$(".home").on("click",this.home.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),this.$main.on("click",".edit",this.userEdit),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},$(photoWalk.init.bind(photoWalk));