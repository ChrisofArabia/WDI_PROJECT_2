"use strict";var photoWalk=photoWalk||{},google=google;photoWalk.home=function(o){o&&o.preventDefault(),this.$main.html('\n    <div class="imagebackdrop">\n      <h1>Welcome to our Humble Home Page</h1>\n      <p>We hope you\'ll enjoy your stay here and choose to hang out a while</p>\n    </div\n    ')},photoWalk.adminTemplate=function(o){var a='\n    <div class="admin-content">\n      <nav class="pure-menu admin-menu">\n        <h3 class="menu-heading">Admin Menu</h3>\n        <ul class="pure-menu-list">\n          <li class="pure-menu-item"><a href="#" class="pure-menu-link landmark-admin">Edit Landmarks</a></li>\n          <li class="pure-menu-item"><a href="#" class="pure-menu-link walk">Edit Walks</a></li>\n          <li class="pure-menu-item"><a href="#" class="pure-menu-link user">Edit Users</a></li>\n        </ul>\n      </nav>\n      <section class="admin-body">'+o+"</section>\n    </div>\n    ";this.$main.html(a)},photoWalk.register=function(o){o&&o.preventDefault;var a="\n    <h2>Register</h2>\n    ",e='\n    <form class="pure-form" method="post" action="/register">\n      <div class="form-group">\n        <label for="username">Enter your username: </label>\n        <input id="username" class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <label for="email">Enter an email address: </label>\n        <input id="email" class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <label for="email">Enter a password: </label>\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <label for="password_conf">Enter the password again: </label>\n        <input id="password_conf" class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="pure-button pure-button-primary" type="submit" value="Register">\n    </form>\n    ',n='\n    <p>Made with <span class="redheart">&hearts;</span> at <a href="https://generalassemb.ly/locations/london">GA</a> in London</p>\n    ';photoWalk.modalTemplate(a,e,n)},photoWalk.login=function(o){o&&o.preventDefault();var a="\n    <h2>Login</h2>\n    ",e='\n    <form class="pure-form" method="post" action="/login">\n      <div class="form-group">\n        <label for="email">Enter your registered email address: </label>\n        <input id="email" class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <label for="password">Enter your password: </label>\n        <input id="password" class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="pure-button pure-button-primary" type="submit" value="Login">\n    </form>\n    ',n='\n    <p>Made with <span class="redheart">&hearts;</span> at <a href="https://generalassemb.ly/locations/london">GA</a> in London</p>\n    ';photoWalk.modalTemplate(a,e,n)},photoWalk.userEdit=function(o){o&&o.preventDefault();var a="http://localhost:3000/api/users",e=a+"/"+$(this).attr("href"),n="PUT";photoWalk.ajaxRequest(e,n,null,function(o){photoWalk.$main.html('\n      <h2>Edit User Profile</h2>\n      <form class="pure-form" method="put" action="/users/'+o.user._id+'">\n        <div class="form-group">\n          <label for="username">User Name</label>\n          <input id="username" class="form-control" type="text" name="user[username]" placeholder="Username" value="'+o.user.username+'">\n        </div>\n        <div class="form-group">\n          <label for="bio">User Biography</label>\n          <input id="bio" class="form-control" type="text" name="user[bio]" placeholder="User bio" value="'+o.user.bio+'">\n        </div>\n        <div class="form-group">\n          <label for="img">Profile Image URL</label>\n          <input id="img" class="form-control" type="text" name="user[img]" value="'+o.user.profilePic+'">\n        </div>\n        <input class="pure-button pure-button-primary" type="submit" value="Update Profile">\n      </form>\n      ')})},photoWalk.landmarkIndex=function(o){var a=this;o&&o.preventDefault(),$.ajax({method:"GET",url:"http://localhost:3000/api/landmarks",beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(function(o){var e="";$.each(o.landmarks,function(o,n){e+='<li value="'+n._id+'"><a href="'+a.apiUrl+"/"+n._id+'">'+n.name+"</a>: "+n.address+". "+n.postcode+".</li>"});var n='\n      <h2 class="admin-header">Landmark Administration</h2>\n      <ul>'+e+"</ul>\n      ";photoWalk.adminTemplate(n)})},photoWalk.createRoute=function(o){o&&o.preventDefault(),$.ajax({method:"GET",url:"http://localhost:3000/api/landmarks",beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(function(o){var a="";$.each(o.landmarks,function(o,e){a+='<option value="'+e.name+'">'+e.name+"</option>"});var e="<h2>Create a Route</h2>",n='\n      <form class="pure-form" method="post" action="/newRoute">\n        <div class="form-group">\n          <label for="email">Add a name for your new route: </label>\n          <input id="route" class="form-control" type="text" name="route" placeholder="Add route name">\n        </div>\n        <div class="form-group">\n          <label for="origin">Enter a start point for your walk: </label>\n          <select id="origin" class="form-control" name="origin">\n            '+a+'\n          </select>\n          <label for="destination">Enter a final destination: </label>\n          <select id="destination" class="form-control" name="destination">\n            '+a+'\n          </select>\n          <input id="origin" class="form-control" type="password" name="password" placeholder="Password">\n        </div>\n        <input class="pure-button pure-button-primary" type="submit" value="Login">\n      </form>\n      ',t='\n      <p>Made with <span class="redheart">&hearts;</span> at <a href="https://generalassemb.ly/locations/london">GA</a> in London</p>';photoWalk.modalTemplate(e,n,t)})},photoWalk.logout=function(o){o.preventDefault(),this.removeToken(),this.loggedOutState()},photoWalk.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.$main.html('<div id="map-canvas"></div>'),this.setupMap()},photoWalk.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.$main.html('<div id="map-canvas"></div>'),this.setupMap()},photoWalk.removeToken=function(){return window.localStorage.clear()},photoWalk.handleForm=function(o){o.preventDefault();var a=""+photoWalk.apiUrl+$(this).attr("action"),e=$(this).attr("method"),n=$(this).serialize();return photoWalk.ajaxRequest(a,e,n,function(o){o.token&&(photoWalk.setToken(o.token),photoWalk.loggedInState(),photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html(""))})},photoWalk.ajaxRequest=function(o,a,e,n){return $.ajax({url:o,method:a,data:e,beforeSend:this.setRequestHeader.bind(this)}).done(n).fail(function(o){console.log(o)})},photoWalk.setRequestHeader=function(o){return o.setRequestHeader("Authorization","Bearer "+this.getToken())},photoWalk.setToken=function(o){return window.localStorage.setItem("token",o)},photoWalk.getToken=function(){return window.localStorage.getItem("token")},photoWalk.addInfoWindowForLandmark=function(o,a){var e=this,n="";google.maps.event.addListener(a,"click",function(){"undefined"!=typeof e.infoWindow&&e.infoWindow.close(),n=o.website?"\n      <a href='"+o.website+"'>\n        <h3>"+o.name+"</h3>\n      </a>\n      ":"<h3>"+o.name+"</h3>",e.infoWindow=new google.maps.InfoWindow({content:"\n      <img src='../images/"+o.file+"' alt='"+o.name+"'>\n      "+n+"\n      <p>"+o.address+"</p>\n      <p>"+o.postcode+"</p>\n      "}),e.infoWindow.open(e.map,a)})},photoWalk.createMarkerForLandmark=function(o){var a=new google.maps.LatLng(o.lat,o.lng),e=new google.maps.Marker({position:a,map:this.map,animation:google.maps.Animation.DROP});this.addInfoWindowForLandmark(o,e)},photoWalk.loopThroughLandmarks=function(o){$.each(o.landmarks,function(o,a){setTimeout(function(){photoWalk.createMarkerForLandmark(a)},50*o)})},photoWalk.getLandmarks=function(){$.ajax({method:"GET",url:"http://localhost:3000/api/landmarks",beforeSend:photoWalk.setRequestHeader.bind(photoWalk)}).done(this.loopThroughLandmarks)},photoWalk.modalTemplate=function(o,a,e){var n='\n    <div class="modal-content">\n      <span class="close">&times;</span>\n      <div class="modal-header">'+o+'</div>\n      <div class="modal-body">'+a+'</div>\n      <div class="modal-footer">'+e+"</div>\n    </div>\n    ";this.$modalContainer.html(n),photoWalk.callModal()},photoWalk.callModal=function(){this.$modalContainer.css("display","block"),$(".close").on("click",function(){photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html("")}),$(window).on("click",function(o){o.target.className===photoWalk.$modalContainer[0].className&&(photoWalk.$modalContainer.css("display","none"),photoWalk.$modalContainer.html(""))})},photoWalk.setupMap=function(){var o=document.getElementById("map-canvas"),a={zoom:15,center:new google.maps.LatLng(51.516026,(-.062226)),mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(o,a),this.getToken()&&this.getLandmarks()},photoWalk.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),this.$modalContainer=$("#modal"),this.setupMap(),$(".home").on("click",this.home.bind(this)),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".createRoute").on("click",this.createRoute.bind(this)),$(".admin").on("click",this.adminTemplate.bind(this)),$(".landmark-admin").on("click",this.landmarkIndex().bind(this)),this.$main.on("click",".edit",this.userEdit),this.$main.on("submit","form",this.handleForm),this.$modalContainer.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},$(photoWalk.init.bind(photoWalk));